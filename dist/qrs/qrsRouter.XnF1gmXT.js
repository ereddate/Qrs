import{C as u,c as h,r as p}from"./qrs.rNeMmnpt.js";import"../chunks/typeCheck.Cq0qUGfz.js";class m{constructor(t){this.routes=t.routes||[],this.mode=t.mode||"hash",this.initialPath=this.mode==="hash"?window.location.hash.slice(1)||"/":window.location.pathname||"/",this.current=p({path:this.mode==="hash"?window.location.hash.slice(1):window.location.pathname}),this.beforeEachGuards=[],this.afterEachHooks=[],this.mode==="hash"?window.addEventListener("hashchange",()=>{this.handleRouteChange(window.location.hash.slice(1))}):window.addEventListener("popstate",()=>{this.handleRouteChange(window.location.pathname)}),this.update=null,this.meta=t.meta||{}}init(){this.push(this.initialPath)}beforeEach(t){this.beforeEachGuards.push(t)}afterEach(t){this.afterEachHooks.push(t)}async handleRouteChange(t){try{const e=this.current.path,r=this.match(t),n=this.match(e);let o=!1;this.update&&this.update(t);const a=await Promise.all(this.beforeEachGuards.map(async s=>{try{return await s(n,r)}catch(c){return console.error("Route guard error:",c),!1}}));for(const s of a)if(s===!1){o=!0;return}else if(String.is(s)){o||(this.push(s),o=!0);return}o||(this.current.path=t),this.afterEachHooks.forEach(s=>{try{s(n,r)}catch(c){console.error("Route hook error:",c)}})}catch(e){console.error("Route change error:",e)}}match(t){return this.routes.find(r=>r.path===t)||this.routes.find(r=>r.path==="*")}async push(t){await this.handleRouteChange(t),this.mode==="hash"?window.location.hash=t:window.history.pushState({},"",t)}async replace(t){await this.handleRouteChange(t),this.mode==="hash"?window.location.replace(`#${t}`):window.history.replaceState({},"",t)}static lazyLoad(t){return{async render(){const{default:e}=await t();return new e().render()}}}}const f=new u({data(){return{currentComponent:null,prevComponent:null,isEntering:!1,isLeaving:!1}},async created(){var e,r,n;(e=this.props.router)==null||e.init();const i=(n=this.props.router)==null?void 0:n.match(((r=this.props.router)==null?void 0:r.current.path)||this.initialPath);i&&(this.currentComponent=i.component);const t=this;this.props.router&&(this.props.router.update=o=>{var s;const a=(s=t.props.router)==null?void 0:s.match(o);a&&(t.isLeaving=!0,t.update(),t.prevComponent=t.currentComponent,t.currentComponent=a.component,t.isLeaving=!1,t.isEntering=!0,t.update(),setTimeout(()=>{t.isEntering=!1},300))})},render(){return this.isLeaving&&this.prevComponent?h(this.prevComponent,{class:"route-leave"}):this.isEntering&&this.currentComponent?h(this.currentComponent,{class:"route-enter"}):this.currentComponent?h(this.currentComponent):h("div",{},"Not Found")}}),w=new u({props:{to:{type:String,required:!0},replace:{type:Boolean,default:!1}},render(){var t,e,r;const i=((e=(t=this.props)==null?void 0:t.router)==null?void 0:e.mode)==="hash"?`#${this.props.to}`:this.props.to;return h("a",{class:((r=this.props)==null?void 0:r.class)||"router-link",href:i,on:{click:n=>{var a;n.preventDefault();const o=(a=this.props)==null?void 0:a.router;o&&(this.props.replace?o.replace(this.props.to):o.push(this.props.to))}}},this.$slots.default)}});export{w as R,m as a,f as b};
